/*!
 * Mapi - An easy to use wrapper for Google Maps API
 * Version: 1.0.3
 * Author: Thiago Ribeiro - thiagofribeiro@gmail.com
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("underscore"),require("jquery")):"function"==typeof define&&define.amd?define(["underscore","jquery"],t):"object"==typeof exports?exports.Mapi=t(require("underscore"),require("jquery")):e.Mapi=t(e._,e.jQuery)}(this,function(e,t){return function(e){function t(n){if(o[n])return o[n].exports;var i=o[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var o={};return t.m=e,t.c=o,t.p="",t(0)}([function(e,t,o){"use strict";function n(e,t){var o={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(o[n]=e[n]);return o}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},r=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}(),s=o(2),p=o(1),c=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],o=t.height,r=void 0===o?"400px":o,p=t.lat,c=void 0===p?0:p,d=t.lng,l=void 0===d?0:d,u=t.zoom,m=void 0===u?2:u,h=n(t,["height","lat","lng","zoom"]);if(i(this,e),h=a({height:r,lat:c,lng:l,zoom:m},h),this.objects={},!h.element)throw"You should use 'element' attribute on options.";var g=s(h.element).attr("id")||s(h.element).attr("name");if(!g)throw"Your element must have a name or id.";if(e.prototype.instances[g]){var f=e.prototype.instances[g];s(h.element).replaceWith(f.map.getDiv()),f.reset(),f.create(h)}else e.prototype.instances[g]=this.create(h);return e.prototype.instances[g]}return r(e,[{key:"create",value:function(t){var o=this;if(google){this.geocoder=new google.maps.Geocoder,t.center=new google.maps.LatLng(t.lat,t.lng),this.mapCenter=t.center,p.each(t.themes,function(e){t.mapTypeControlOptions=t.mapTypeControlOptions||[],t.mapTypeControlOptions.mapTypeIds=t.mapTypeControlOptions.mapTypeIds||[],p.contains(p.keys(google.maps.MapTypeId),e.toUpperCase())&&(e=google.maps.MapTypeId[e.toUpperCase()]),p.contains(t.mapTypeControlOptions.mapTypeIds,e)||t.mapTypeControlOptions.mapTypeIds.push(e)});var n=s(t.element).find(".controls").clone();this.map?this.map.setOptions(t):this.map=new google.maps.Map(s(t.element)[0],t),s(t.element).append(n),n.each(function(e,t){var o=s(t).data("position");s(t).children().each(function(e,t){this.addControl(t,o)}.bind(this))}.bind(this)),s(t.element).css("height",t.height),p.each(t.themes,function(t){o.map.mapTypes.set(t,new google.maps.StyledMapType(e.prototype.themes[t],{name:t}))}),t.defaultTheme&&this.setTheme(t.defaultTheme),this.map.setCenter(this.mapCenter),google.maps.event.trigger(this.map,"resize")}else console.error("Google Maps is not yet available");return this}},{key:"addMarker",value:function(e){var t=e.groupId,o=void 0===t?"markers":t,i=e.id,a=void 0===i?p.uniqueId("marker-"):i,r=e.lat,s=e.lng,c=e.content,d=n(e,["groupId","id","lat","lng","content"]);if(!this.existsObject({groupId:o,id:a})){d.position=new google.maps.LatLng(r,s),d.map=this.map,d.iconCenter&&(d.icon={url:d.icon,anchor:new google.maps.Point(d.iconCenter[0],d.iconCenter[1])}),d.animation&&(d.animation=google.maps.Animation[d.animation]);var l=new google.maps.Marker(d);return l.id=a,l.setMap(this.map),this.addObject({groupId:o,id:a,object:l}),c&&this.addInfoWindow({groupId:o,id:a,content:c,onlyOneActive:!0}),p.each(d.events,function(e,t){google.maps.event.addListener(l,t,function(t){e(t,l,a)})}),l}}},{key:"addCircle",value:function(e){var t=e.groupId,o=void 0===t?"circle":t,i=e.id,a=void 0===i?p.uniqueId("circle-"):i,r=e.lat,s=e.lng,c=n(e,["groupId","id","lat","lng"]);if(!this.existsObject(o,a)){c.center={lat:r,lng:s},c.map=this.map,c.iconCenter&&(c.icon={url:c.icon,anchor:new google.maps.Point(c.iconCenter[0],c.iconCenter[1])}),c.animation&&(c.animation=google.maps.Animation[c.animation]);var d=new google.maps.Circle(c);return d.id=a,d.setMap(this.map),this.addObject({groupId:o,id:a,object:d}),d}}},{key:"addObject",value:function(e){var t=e.groupId,o=e.id,n=e.object;this.objects[t]||(this.objects[t]={}),this.existsObject({groupId:t,id:o})&&this.removeObject({groupId:t,id:o}),this.objects[t][o]=n,n.mapi=n.mapi||{},n.mapi.groupId=t,n.mapi.id=o}},{key:"addInfoWindow",value:function(e){var t,o=e.groupId,i=e.id,a=n(e,["groupId","id"]);if(!this.objects[o]||!this.objects[o][i])throw"Object "+o+"/"+i+" not found";t=this.objects[o][i],a.content=a.content||t.id;var r=new google.maps.InfoWindow(a);this.addObject({groupId:"infoWindow",id:o+"-"+i,object:r}),t&&t.addListener("click",function(){a.onlyOneActive&&a.onlyOneActive===!0&&p(this.objects.infoWindow).each(function(e){e.close()}),r.open(this.map,t)}.bind(this))}},{key:"removeObjects",value:function(e){var t=this,o=e.groupId;if("undefined"==typeof o)throw'The attribute "groupId" should be defined.';p(this.objects[o]).each(function(e,n){t.removeObject({groupId:o,id:n})})}},{key:"removeObject",value:function(e){var t=e.groupId,o=e.id;if("undefined"==typeof t||"undefined"==typeof o)throw'The attributes "groupId" and "id" should be defined.';if(this.existsObject({groupId:t,id:o})){var n=this.objects[t][o];if(n){if(n.setMap&&n.setMap(null),n.remove&&n.remove(),n.data){var i=n.data("position"),a=n.data("index");this.map.controls[google.maps.ControlPosition[i]].getAt(a)&&(this.map.controls[google.maps.ControlPosition[i]].removeAt(a),this.map.controls[google.maps.ControlPosition[i]].forEach(function(e,t){s(e).attr("data-index",t)}))}n=null,delete this.objects[t][o]}}}},{key:"existsObject",value:function(e){var t=e.groupId,o=e.id;return"undefined"!=typeof this.objects[t]?"undefined"!=typeof this.objects[t][o]:!1}},{key:"reset",value:function(){var e=this;p(this.objects).each(function(t,o){e.removeObjects({groupId:o})})}},{key:"setTheme",value:function(e){p.contains(p.keys(google.maps.MapTypeId),e.toUpperCase())&&(e=google.maps.MapTypeId[e.toUpperCase()]),this.map.setMapTypeId(e)}},{key:"addControl",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?"TOP_LEFT":arguments[1],o=s(e),n=o.attr("id")||p.uniqueId("control-"),i="controls";return o.attr("id",n),o.addClass("mapControl")[0],o.attr("data-position",t),o.attr("data-index",this.map.controls[google.maps.ControlPosition[t]].length),this.map.controls[google.maps.ControlPosition[t]].push(o[0]),this.addObject({groupId:i,id:n,object:o}),o}},{key:"toggleVisibility",value:function(e,t){var o=this;t?this.objects[e][t]&&o.objects[e][t].setMap(o.objects[e][t].map==o.map?null:o.map):p.each(this.objects[e],function(e){e.setMap(e.map==o.map?null:o.map)})}}],[{key:"addTheme",value:function(t,o){e.prototype.themes=e.prototype.themes||{},e.prototype.themes[t]=o}},{key:"registerPlugin",value:function(e){var t=this;p.each(e,function(e,o){t.prototype[o]=e})}}]),e}();c.prototype.instances=c.prototype.instances||{},e.exports=c},function(t,o){t.exports=e},function(e,o){e.exports=t}])});